# Ask Gugan - Complete Chat History Flow Diagram

## ğŸ”„ Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ AskGuganScreen   â”‚              â”‚ AskGuganChatScreen   â”‚        â”‚
â”‚  â”‚ (Chat List)      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ (Active Chat)        â”‚        â”‚
â”‚  â”‚                  â”‚    onBack    â”‚                      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–²                          â”‚
                          â”‚                          â”‚
                    Load List                   Send Message
                          â”‚                          â”‚
                          â”‚                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND API LAYER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  GET /conversations/:userId      POST /openai or /gemini            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ 1. Fetch all convos â”‚         â”‚ 1. Get history       â”‚          â”‚
â”‚  â”‚ 2. Filter by userId â”‚         â”‚ 2. Call AI API       â”‚          â”‚
â”‚  â”‚ 3. Sort by time     â”‚         â”‚ 3. Save messages     â”‚          â”‚
â”‚  â”‚ 4. Return list      â”‚         â”‚ 4. Return response   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                          â”‚
                          â”‚                          â”‚
                          â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPABASE KV STORE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  Key: "conversation:conv_123"                                        â”‚
â”‚  Value: [                                                            â”‚
â”‚    { role: "user", content: "...", user_id: "...", timestamp: ... } â”‚
â”‚    { role: "assistant", content: "...", user_id: "...", ... }       â”‚
â”‚  ]                                                                   â”‚
â”‚                                                                      â”‚
â”‚  Key: "conversation:conv_456"                                        â”‚
â”‚  Value: [ ... ]                                                      â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± User Journey: New User First Chat

```
Step 1: Open Ask Gugan Tab
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AskGuganScreen          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  [Loading...]      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ useEffect() â†’ loadConversations()
         â”‚ API: GET /conversations/user_123
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend Response:       â”‚
â”‚  {                       â”‚
â”‚    conversations: [],    â”‚
â”‚    count: 0              â”‚
â”‚  }                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AskGuganScreen          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [Murugan Avatar]   â”‚  â”‚
â”‚  â”‚   à®µà®£à®•à¯à®•à®®à¯! ğŸ™     â”‚  â”‚
â”‚  â”‚                    â”‚  â”‚
â”‚  â”‚ Start your first   â”‚  â”‚
â”‚  â”‚ conversation...    â”‚  â”‚
â”‚  â”‚                    â”‚  â”‚
â”‚  â”‚ [+ Start New Chat] â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Step 2: User Clicks "Start New Chat"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AskGuganChatScreen      â”‚
â”‚  chatId = "new"          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Welcome Screen     â”‚  â”‚
â”‚  â”‚                    â”‚  â”‚
â”‚  â”‚ [Animated GIF]     â”‚  â”‚
â”‚  â”‚                    â”‚  â”‚
â”‚  â”‚ [8 Feature Cards]  â”‚  â”‚
â”‚  â”‚ â€¢ Find Temples     â”‚  â”‚
â”‚  â”‚ â€¢ Songs            â”‚  â”‚
â”‚  â”‚ â€¢ Panchang         â”‚  â”‚
â”‚  â”‚ â€¢ Stories...       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Step 3: User Sends First Message
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User types:             â”‚
â”‚  "Find temples near me"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ handleSend()
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /openai            â”‚
â”‚  {                       â”‚
â”‚    message: "Find...",   â”‚
â”‚    conversation_id: null,â”‚
â”‚    user_id: "user_123",  â”‚
â”‚    language: "en"        â”‚
â”‚  }                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Backend generates conv_123
         â”‚ Saves to KV store
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend Response:       â”‚
â”‚  {                       â”‚
â”‚    conversation_id:      â”‚
â”‚      "conv_123",         â”‚
â”‚    message: "Om Muruga"  â”‚
â”‚  }                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AskGuganChatScreen      â”‚
â”‚  conversationId = conv_123â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ User: Find temples â”‚  â”‚
â”‚  â”‚ AI: Om Muruga ğŸ™   â”‚  â”‚
â”‚  â”‚     I found 5...   â”‚  â”‚
â”‚  â”‚                    â”‚  â”‚
â”‚  â”‚ [Input Box]        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Step 4: User Goes Back
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User clicks back button â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ onBack() â†’ setActiveChatId(null)
         â”‚           setChatListRefreshKey(prev + 1)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AskGuganScreen remounts â”‚
â”‚  key = {refreshKey}      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ useEffect() â†’ loadConversations()
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend Response:       â”‚
â”‚  {                       â”‚
â”‚    conversations: [      â”‚
â”‚      {                   â”‚
â”‚        id: "conv_123",   â”‚
â”‚        title: "Find...", â”‚
â”‚        lastMessage: "... â”‚
â”‚        timestamp: "..."  â”‚
â”‚      }                   â”‚
â”‚    ]                     â”‚
â”‚  }                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AskGuganScreen          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [Avatar] Find...   â”‚  â”‚
â”‚  â”‚     Om Muruga...   â”‚  â”‚
â”‚  â”‚              2:45PMâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚
â”‚  [+ New Chat Button]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Returning User Flow

```
Step 1: User Opens Ask Gugan
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AskGuganScreen          â”‚
â”‚  userId = "user_123"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ useEffect() loads conversations
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API: GET /conversations/user_123    â”‚
â”‚                                      â”‚
â”‚  Backend:                            â”‚
â”‚  1. Query KV store for all convos   â”‚
â”‚  2. Filter by user_id = "user_123"  â”‚
â”‚  3. Sort by timestamp DESC           â”‚
â”‚  4. Return list                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response: 5 conversations           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chat List Rendered:                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ [Avatar] Temple Visit   2:45PMâ”‚   â”‚
â”‚  â”‚     Om Muruga ğŸ™...          â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ [Avatar] Prayer Times  Yesterâ”‚   â”‚
â”‚  â”‚     Morning prayers...       â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ [Avatar] Kavadi Prep  Monday â”‚   â”‚
â”‚  â”‚     à®•à®µà®Ÿà®¿ à®à®Ÿà¯à®ªà¯à®ªà®¤à®±à¯à®•à¯...     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ [Avatar] Arupadai Info Sundayâ”‚   â”‚
â”‚  â”‚     The six abodes...        â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ [Avatar] Festival Date  12/20â”‚   â”‚
â”‚  â”‚     à®¤à¯ˆà®ªà¯à®ªà¯‚à®šà®®à¯ is on...      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â”‚  [+ New Chat Button]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Step 2: User Clicks Conversation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  onClick("conv_123")     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ setActiveChatId("conv_123")
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AskGuganChatScreen      â”‚
â”‚  chatId = "conv_123"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ useEffect() detects chatId !== "new"
         â”‚ loadChatHistory()
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API: GET /conversation/conv_123     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend Response:                   â”‚
â”‚  {                                   â”‚
â”‚    messages: [                       â”‚
â”‚      { role: "user", content: ... }, â”‚
â”‚      { role: "assistant", ... },     â”‚
â”‚      { role: "user", ... },          â”‚
â”‚      { role: "assistant", ... }      â”‚
â”‚    ]                                 â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chat Screen Renders Full History:   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ User: Find temples near me     â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ AI: Om Muruga ğŸ™               â”‚  â”‚
â”‚  â”‚     I found 5 temples...       â”‚  â”‚
â”‚  â”‚     [Temple Card 1]            â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ User: Tell me about Palani     â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ AI: Palani is one of the       â”‚  â”‚
â”‚  â”‚     Arupadai Veedu...          â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ [Input Box]                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Step 3: User Continues Conversation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User types:             â”‚
â”‚  "How to reach Palani?"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ handleSend()
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /openai                         â”‚
â”‚  {                                    â”‚
â”‚    message: "How to reach...",        â”‚
â”‚    conversation_id: "conv_123",       â”‚
â”‚    user_id: "user_123"                â”‚
â”‚  }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Backend:
         â”‚ 1. Loads existing history from conv_123
         â”‚ 2. Appends user message
         â”‚ 3. Gets AI response
         â”‚ 4. Appends AI message
         â”‚ 5. Saves updated history
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  KV Store Updated:                    â”‚
â”‚  conversation:conv_123 = [            â”‚
â”‚    ... previous messages ...,         â”‚
â”‚    { role: "user", content: "How..." }â”‚
â”‚    { role: "assistant", content: ... }â”‚
â”‚  ]                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response shown in chat:              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ User: How to reach Palani?     â”‚  â”‚
â”‚  â”‚                                â”‚  â”‚
â”‚  â”‚ AI: You can reach Palani by... â”‚  â”‚
â”‚  â”‚     [Map/Directions Card]      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Data Flow: Message Storage

```
Frontend                Backend                 KV Store
â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€â”€â”€â”€

User sends message
"Find temples"
    â”‚
    â”œâ”€â”€POSTâ”€â”€â”€â”€â”€â”€â–º  1. Receive request
    â”‚               {
    â”‚                 message: "Find...",
    â”‚                 conversation_id: null,
    â”‚                 user_id: "user_123"
    â”‚               }
    â”‚
    â”‚               2. Check if new convo
    â”‚                  â†’ Yes, generate ID
    â”‚                  conv_123
    â”‚
    â”‚               3. Get user memories
    â”‚                  (for context)
    â”‚
    â”‚               4. Call OpenAI/Gemini
    â”‚                  with system prompt
    â”‚
    â”‚               5. Receive AI response
    â”‚                  "Om Muruga ğŸ™..."
    â”‚
    â”‚               6. Build history array
    â”‚                  [
    â”‚                    {
    â”‚                      role: "user",
    â”‚                      content: "Find...",
    â”‚                      timestamp: "...",
    â”‚                      user_id: "user_123",
    â”‚                      conversation_id: "conv_123"
    â”‚                    },
    â”‚                    {
    â”‚                      role: "assistant",
    â”‚                      content: "Om Muruga...",
    â”‚                      timestamp: "...",
    â”‚                      user_id: "user_123",
    â”‚                      conversation_id: "conv_123"
    â”‚                    }
    â”‚                  ]
    â”‚
    â”‚               7. Save to KV store â”€â”€â”€â”€â”€â”€â”€â”€â–º kv.set()
    â”‚                                             Key: "conversation:conv_123"
    â”‚                                             Value: [history array]
    â”‚
    â—„â”€â”€RESPONSEâ”€â”€â”€â”€ 8. Return response
                    {
                      conversation_id: "conv_123",
                      message: "Om Muruga..."
                    }

Display AI response
Set conversationId = conv_123
```

---

## ğŸ” Data Flow: Loading Conversations

```
Frontend                Backend                 KV Store
â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€â”€â”€â”€

AskGuganScreen mounts
    â”‚
    â”œâ”€â”€GETâ”€â”€â”€â”€â”€â”€â”€â–º GET /conversations/user_123
    â”‚
    â”‚              1. Query KV store â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º SELECT * FROM kv_store
    â”‚                                           WHERE key LIKE 'conversation:%'
    â”‚                                           
    â”‚              2. Receive all convos â—„â”€â”€â”€â”€â”€
    â”‚                 [
    â”‚                   {
    â”‚                     key: "conversation:conv_123",
    â”‚                     value: [messages...]
    â”‚                   },
    â”‚                   {
    â”‚                     key: "conversation:conv_456",
    â”‚                     value: [messages...]
    â”‚                   },
    â”‚                   ...
    â”‚                 ]
    â”‚
    â”‚              3. Filter by user_id
    â”‚                 â†’ Check each message array
    â”‚                 â†’ Keep if has user_123
    â”‚
    â”‚              4. Extract metadata
    â”‚                 For each conversation:
    â”‚                 - ID from key
    â”‚                 - Title from first message
    â”‚                 - Last message content
    â”‚                 - Timestamp from last message
    â”‚
    â”‚              5. Sort by timestamp DESC
    â”‚
    â—„â”€â”€RESPONSEâ”€â”€â”€â”€ 6. Return formatted list
                    {
                      conversations: [
                        {
                          id: "conv_456",
                          title: "Prayer Times",
                          lastMessage: "Morning...",
                          timestamp: "2025-11-28T14:30:00Z"
                        },
                        {
                          id: "conv_123",
                          title: "Find temples",
                          lastMessage: "Om Muruga...",
                          timestamp: "2025-11-28T10:30:00Z"
                        }
                      ]
                    }

Display conversations
Sort by most recent first
```

---

## ğŸ¨ State Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         App.tsx                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  State:                                                      â”‚
â”‚  â€¢ activeTab: Tab                                            â”‚
â”‚  â€¢ activeChatId: string | null                               â”‚
â”‚  â€¢ chatListRefreshKey: number                                â”‚
â”‚  â€¢ user: User                                                â”‚
â”‚                                                              â”‚
â”‚  Flow:                                                       â”‚
â”‚  1. User opens Ask Gugan â†’ activeTab = "gugan"              â”‚
â”‚  2. User clicks chat â†’ setActiveChatId("conv_123")          â”‚
â”‚  3. User clicks back â†’ setActiveChatId(null)                â”‚
â”‚                       setChatListRefreshKey(prev + 1)        â”‚
â”‚                                                              â”‚
â”‚  Rendering:                                                  â”‚
â”‚  if (activeChatId) {                                         â”‚
â”‚    return <AskGuganChatScreen chatId={activeChatId} />      â”‚
â”‚  } else {                                                    â”‚
â”‚    return <AskGuganScreen key={chatListRefreshKey} />       â”‚
â”‚  }                                                           â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                  â”‚
                          â”‚                  â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                          â”‚
              â–¼                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    AskGuganScreen           â”‚    â”‚   AskGuganChatScreen        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚    â”‚                             â”‚
â”‚  Props:                     â”‚    â”‚  Props:                     â”‚
â”‚  â€¢ onStartChat              â”‚    â”‚  â€¢ chatId                   â”‚
â”‚  â€¢ userId                   â”‚    â”‚  â€¢ onBack                   â”‚
â”‚  â€¢ key (refresh trigger)    â”‚    â”‚  â€¢ userId                   â”‚
â”‚                             â”‚    â”‚                             â”‚
â”‚  State:                     â”‚    â”‚  State:                     â”‚
â”‚  â€¢ chats: Chat[]            â”‚    â”‚  â€¢ messages: Message[]      â”‚
â”‚  â€¢ loading: boolean         â”‚    â”‚  â€¢ conversationId: string   â”‚
â”‚  â€¢ error: string            â”‚    â”‚  â€¢ inputText: string        â”‚
â”‚  â€¢ searchQuery: string      â”‚    â”‚  â€¢ isLoading: boolean       â”‚
â”‚                             â”‚    â”‚  â€¢ showWelcome: boolean     â”‚
â”‚                             â”‚    â”‚                             â”‚
â”‚  Effects:                   â”‚    â”‚  Effects:                   â”‚
â”‚  â€¢ Load conversations       â”‚    â”‚  â€¢ Initialize chat          â”‚
â”‚    on mount                 â”‚    â”‚  â€¢ Load history if existing â”‚
â”‚  â€¢ Remount on key change    â”‚    â”‚  â€¢ Scroll to bottom         â”‚
â”‚                             â”‚    â”‚                             â”‚
â”‚  Functions:                 â”‚    â”‚  Functions:                 â”‚
â”‚  â€¢ loadConversations()      â”‚    â”‚  â€¢ loadChatHistory()        â”‚
â”‚  â€¢ formatTimestamp()        â”‚    â”‚  â€¢ handleSend()             â”‚
â”‚  â€¢ filter chats             â”‚    â”‚  â€¢ handleQuickAction()      â”‚
â”‚                             â”‚    â”‚  â€¢ handleImageUpload()      â”‚
â”‚                             â”‚    â”‚  â€¢ voice recording          â”‚
â”‚                             â”‚    â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security & User Isolation

```
User A (user_abc)          Backend              User B (user_xyz)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Conversation conv_123     KV Store             Conversation conv_456
â”œâ”€ user_id: "user_abc" â”€â”€â–º stored â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”œâ”€ user_id: "user_xyz"
â””â”€ messages: [...]                              â””â”€ messages: [...]


User A requests:
GET /conversations/user_abc
                â”‚
                â”œâ”€â”€â–º Backend filters:
                â”‚    â€¢ Load all conversations
                â”‚    â€¢ Check each for user_id = "user_abc"
                â”‚    â€¢ Return only matching ones
                â”‚
                â””â”€â”€â–º Returns: conv_123 only
                     (conv_456 is hidden)


User B requests:
GET /conversations/user_xyz
                â”‚
                â”œâ”€â”€â–º Backend filters:
                â”‚    â€¢ Load all conversations
                â”‚    â€¢ Check each for user_id = "user_xyz"
                â”‚    â€¢ Return only matching ones
                â”‚
                â””â”€â”€â–º Returns: conv_456 only
                     (conv_123 is hidden)


âœ… Each user sees only their own conversations
âœ… User isolation enforced at backend level
âœ… No cross-user data leakage
```

---

## ğŸš€ Performance Optimizations

```
1. Conversation Loading
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â€¢ Load once on mount                    â”‚
   â”‚ â€¢ Cache in component state              â”‚
   â”‚ â€¢ Refresh only on explicit trigger      â”‚
   â”‚   (chatListRefreshKey change)           â”‚
   â”‚ â€¢ No polling or websockets              â”‚
   â”‚   (keeps it simple and efficient)       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. Message History Loading
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â€¢ Load only when chat is opened         â”‚
   â”‚ â€¢ Full history loaded at once           â”‚
   â”‚   (fine for devotional Q&A length)      â”‚
   â”‚ â€¢ No pagination needed yet              â”‚
   â”‚ â€¢ Future: Add pagination if needed      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. Search
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â€¢ Client-side filtering                 â”‚
   â”‚ â€¢ Instant results                       â”‚
   â”‚ â€¢ Searches title + lastMessage          â”‚
   â”‚ â€¢ No backend calls                      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. Refresh Strategy
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â€¢ React key-based remounting            â”‚
   â”‚ â€¢ Triggers clean re-fetch               â”‚
   â”‚ â€¢ Clears old state automatically        â”‚
   â”‚ â€¢ Simple and reliable                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**This diagram shows the complete data flow and architecture of the Ask Gugan chat history system!**
